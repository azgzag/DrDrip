<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Doctor Drip - Panier / Checkout</title>
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background: #121217;
      color: #e0e0e0;
      margin: 0;
      padding: 20px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    h1 {
      text-align: center;
      margin-top: 20px;
      margin-bottom: 20px;
      color: #818cf8;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
      background: #1f2937;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 16px rgba(79, 70, 229, 0.6);
    }
    th, td {
      padding: 15px 12px;
      text-align: left;
    }
    th {
      background: #374151;
      color: #94a3b8;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.85em;
      letter-spacing: 0.05em;
    }
    tbody tr {
      border-bottom: 1px solid #374151;
    }
    tbody tr:last-child {
      border-bottom: none;
    }
    td {
      color: #cbd5e1;
    }
    .total-row td {
      font-weight: 700;
      font-size: 1.1em;
      color: #e0e7ff;
    }
    button {
      background-color: #6366f1;
      border: none;
      padding: 12px 20px;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #4f46e5;
    }
    #empty-cart-btn {
      margin-bottom: 30px;
      display: block;
      width: 100%;
      max-width: 200px;
      margin-left: auto;
      margin-right: auto;
    }
    form {
      background: #1e293b;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 12px 24px rgba(0,0,0,0.8);
      color: #cbd5e1;
    }
    form h2 {
      margin-top: 0;
      margin-bottom: 20px;
      color: #818cf8;
      font-weight: 600;
      text-align: center;
    }
    form label {
      display: block;
      margin: 12px 0 6px;
      font-weight: 600;
    }
    form input, form select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-size: 1em;
      margin-bottom: 15px;
    }
    form button[type="submit"] {
      margin-top: 15px;
      width: 100%;
    }
    #empty-message {
      text-align: center;
      margin-top: 80px;
      font-style: italic;
      color: #6b7280;
    }
    
  </style>
</head>
<body>

<!-- Bouton retour -->
<div style="text-align:left; margin-bottom: 30px;">
  <a href="shop.html" style="
    display: inline-block;
    background-color: #818cf8;
    color: white;
    padding: 10px 18px;
    border-radius: 10px;
    font-weight: 600;
    text-decoration: none;
    box-shadow: 0 6px 12px rgba(129, 140, 248, 0.6);
    transition: background-color 0.3s ease;
  " onmouseover="this.style.backgroundColor='#6366f1'" onmouseout="this.style.backgroundColor='#818cf8'">
    ← Retour à la boutique
  </a>
</div>

<h1>Votre Panier</h1>

<div id="cart-container">
  <table id="cart-table" style="display:none;">
    <thead>
      <tr>
        <th>Produit</th>
        <th>Taille</th>
        <th>Couleur</th>
        <th>Quantité</th>
        <th>Prix unitaire</th>
        <th>Sous-total</th>
      </tr>   
    </thead>
    <tbody id="cart-body"></tbody>
    <tfoot>
      <tr class="total-row">
        <td colspan="5">Total</td>
        <td id="total-price">0,00 €</td>
      </tr>
    </tfoot>
  </table>
  <p id="empty-message" style="display:none;">Votre panier est vide.</p>

  <button id="empty-cart-btn" style="display:none;">Vider le panier</button>
</div>

<form id="checkout-form" style="display:none;">
  <h2>Informations de livraison</h2>

  <label for="fullname">Nom complet</label>
  <input type="text" id="fullname" name="fullname" required />

  <label for="email">Email</label>
  <input type="email" id="email" name="email" required />

  <label for="address">Adresse</label>
  <input type="text" id="address" name="address" required />

  <label for="city">Ville</label>
  <input type="text" id="city" name="city" required />

  <label for="zipcode">Code postal</label>
  <input type="text" id="zipcode" name="zipcode" required />

  <button type="submit">Valider et payer</button>
</form>

<script src="https://js.stripe.com/v3/"></script>
<script>
  // Charger le panier depuis localStorage
  function loadCart() {
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    if(cart.length === 0) {
      document.getElementById('cart-table').style.display = 'none';
      document.getElementById('empty-message').style.display = 'block';
      document.getElementById('empty-cart-btn').style.display = 'none';
      document.getElementById('checkout-form').style.display = 'none';
      return;
    }

    const tbody = document.getElementById('cart-body');
    tbody.innerHTML = '';

    // Regrouper les mêmes produits avec même taille + couleur pour additionner quantités
    const grouped = {};
    cart.forEach(item => {
      const key = `${item.name}-${item.size}-${item.color}`;
      if(grouped[key]) {
        grouped[key].quantity += item.quantity;
      } else {
        grouped[key] = {...item};
      }
    });

    let total = 0;
    for(const key in grouped) {
      const item = grouped[key];
      const subTotal = item.price * item.quantity;
      total += subTotal;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.name}</td>
        <td>${item.size}</td>
        <td>${item.color}</td>
        <td>${item.quantity}</td>
        <td>${item.price.toFixed(2)} €</td>
        <td>${subTotal.toFixed(2)} €</td>
      `;
      tbody.appendChild(tr);
    }

    document.getElementById('total-price').innerText = total.toFixed(2) + ' €';

    document.getElementById('cart-table').style.display = '';
    document.getElementById('empty-message').style.display = 'none';
    document.getElementById('empty-cart-btn').style.display = 'block';
    document.getElementById('checkout-form').style.display = 'block';
  }

  // Vider le panier
  document.getElementById('empty-cart-btn').addEventListener('click', () => {
    if(confirm('Voulez-vous vraiment vider le panier ?')) {
      localStorage.removeItem('cart');
      loadCart();
    }
  });

  // Soumission du formulaire (demo Stripe basique)
  document.getElementById('checkout-form').addEventListener('submit', e => {
    e.preventDefault();
    alert('Paiement simulé — ici tu implémenterais Stripe ou autre.');
    // TODO: intégrer Stripe ici
  });

  // Initialisation
  loadCart();
</script>

</body>
</html>
